{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"K8TRE Azure Infrastructure","text":"<p>K8TRE-Azure infrastructure is a IaC reference implementation that provides base resources required to deploy K8TRE MVP on Azure (i.e. AKS). Developed by LTH as part of the EPSRC-funded TREvolution project, this project is designed to deploy nessasary resources (e.g. AKS, Private DNS Zones, etc) into a pre-existing hub-spoke based landing zone created at LTH.     </p> <p>To try K8TRE on Azure, go to Get Started guide.</p> <p>Warning</p> <p>This IaC project is in alpha-stage development and is designed to support the deployment of K8TRE MVP on Azure. Beware, K8TRE-Azure IaC requires a specified hub-spoke landing zone designed for LTH requirements.  </p>"},{"location":"landing_zone/","title":"Hub-spoke Landing Zone","text":"<p>The K8TRE-Azure IaC project requires a pre-existing landing zone ecosystem with a baseline set of resources that include specific Azure subscriptions, security policies and networking topology including private VNET peers, NSGs and subnets. Note, this landing zone ecosystem is tailored to organisational needs of LTH and is provided as a reference implementation to enable the deployment of the K8TRE-Azure IaC project.</p> <p>Management Group &amp; Subscription Design</p> <p></p> <p>Hub-Spoke Network Topology</p> <p></p>"},{"location":"overview/","title":"K8TRE Infrastrucutre Guide","text":""},{"location":"overview/#overview","title":"Overview","text":"<p>As a K8TRE prerequsite, a base infrastructure must be provisioned that incorporates a small number of resources required to operate K8TRE within your organisation:</p> <ul> <li>CNCF Kubernetes Distribution<ul> <li>Private cluster configuration</li> <li>Secure compute (nodepool)</li> </ul> </li> <li>Networking<ul> <li>L4 &amp; L7 (Application Layer) traffic routing</li> <li>Private &amp; public DNS management</li> <li>Hub-spoke topology</li> <li>K8s control plane &amp; nodepool private endpoints</li> <li>Restricted public ingress (Public Gateway) </li> </ul> </li> <li>ArgoCD for managing the provision of K8TRE K8s services     </li> <li>Storage to support secure workspaces and core shared services</li> </ul> <p>This guide provides early details of a reference infrastructure developed by LTH for operating K8TRE on Azure Cloud.</p> <p>Warning</p> <p>This IaC project is in alpha-stage development and is designed to support the deployment of K8TRE MVP on Azure. Beware, K8TRE-Azure IaC requires a specified hub-spoke landing zone designed for LTH requirements.</p>"},{"location":"overview/#karectl","title":"KARECTL","text":"<p>KARECTL represents LTH's implementation of K8TRE within the organisation's existing digital ecosystem. KARECTL comprises three layers: </p> <p></p> <ul> <li> <p>Landing Zone - represents a landing zone in Azure based on a hub-spoke design pattern that provides a private networking topology, governance (i.e. EntraID, Azure Policy) and key security (i.e. Azure Firewall) resources. For more information, see here.</p> </li> <li> <p>K8TRE-Azure Infrastructure - provides Azure-specific and in-cluster resources (e.g. AKS, ArgoCD, Cilium BYO CNI) required to enable the deployment, operation and continued development of K8TRE. In particular, KARECTL implements K8TRE following a promotion-based development and deployment pattern to better support continuous integration and delivery (CICD) processes for TRE developers.</p> </li> <li> <p>K8TRE comprises K8TRE's in-cluster agnostic services (e.g. DNS, storage, TLS management) and core applications (i.e. jupyterhub, cr8tor) that are deployed and maintained via a declarative GitOps approach based on ArgoCD's management cluster model (however it is also possible to deploy K8TRE following a ArgoCD per Cluster model). Note that organisation's are expected to fork the K8TRE repository and configure a chosen ArgoCD instance as its primary repository.</p> </li> </ul>"},{"location":"overview/#k8tre-azure-infrastructure","title":"K8TRE-Azure Infrastructure","text":"<p>A recipe for the infrastructure resources required to deploy K8TRE MVP on Azure is provided here. The IaC (Terragrunt/Terraform) deploys K8TRE dependent resources within the underlying 'landing zone' set up at LTH. Following a Terragrunt stacks approach to organise and manage Terraform modules (resources) that have dependencies between them, the project deploys three core stacks of resources: - The Network Services stack provisions specific networking resources (e.g. Azure App Gateway, Private DNS Zones, Public IPs) that must be established prior to provisioning K8TRE clusters - The K8TRE Management stack creates an AKS cluster that acts as the management control plane for all other target K8TRE clusters (i.e. development, staging, production). It installs ArgoCD and automates the set up of secure connections to all other external K8TRE clusters defined as separate stacks (i.e. see dev, stg and prd stacks in the envs/ directory) - K8TRE Cluster a K8TRE cluster stack signals the creation of a AKS cluster that includes the installation of Cilium as the default CNI, ArgoCD service accounts and Gateway API CRDs. In addition to the AKS cluster, the stack creates supporting resources that include an Azure KeyVault, Storage Account and Application IDs (+ Managed Identities) that allow K8TRE agnostic services (e.g. external-dns) to leverage AKS-enabled OIDC Workload Identify Federation to avoid the need for k8s services to manage secrets.</p>"},{"location":"overview/#modules-dependencies","title":"Modules &amp; Dependencies","text":"<p>Each stack specifies which of the following terraform modules (and associated resources) are deployed into the Azure landing zone:</p> <ul> <li>cluster deploys AKS clusters with networking, storage, and security</li> <li>cluster-dns sets up DNS management with ExternalDNS</li> <li>cluster-gateway configures internal Gateway with Cilium CNI</li> <li>cluster-gitops deploys ArgoCD with Azure AD integration into management cluster</li> <li>cluster-argocd configures target k8TRE clusters to be managed by the ArgoCD management cluster</li> <li>infra-network creates shared networking and external Application Gateway</li> </ul>"},{"location":"overview/#modules-resources","title":"Modules &amp; Resources","text":"<p>This section outlines the high-level resources each module manages. For a full listing of modules and resources see detailed documentation under the Modules tab.</p> <ul> <li>Cluster module establishes a target private AKS cluster for K8TRE.<ul> <li>Core Infrastructure<ul> <li>Resource Group - Container for all AKS cluster resources</li> <li>User Assigned Managed Identity - Identity for the AKS cluster</li> </ul> </li> <li>Networking &amp; DNS<ul> <li>Private DNS Zone Virtual Network Link (i.e. Links AKS private DNS zone to spoke network)</li> </ul> </li> <li>Private AKS Cluster (via Azure Verified Module)<ul> <li>BYO CNI (i.e. no CNI plugin)</li> <li>Single workload node pool (Standard_D2d_v5)</li> <li>Private DNS zone integration</li> <li>AAD RBAC integration (associated with prerequiste EntraID admin group)</li> </ul> </li> <li>Storage Infrastructure<ul> <li>Azure Storage Account (Two for workspaces and core cluster storage requirements)</li> <li>Role Assignments (i.e. Storage Blob Data Contributor, Key Vault Secrets Officer etc)</li> </ul> </li> <li>Private Endpoints (for storage accounts + keyvault)</li> <li>Key Vault for cluster secrets storage</li> </ul> </li> <li>external-dns module includes resources to enable external-dns agnostic service in K8TRE to intergate with Azure Private DNS<ul> <li>User Assigned Managed Identity - For ExternalDNS workload identity</li> <li>Federated Identity Credential - Links Kubernetes service account to Azure identity</li> <li>Private DNS Zone - Custom domain for the cluster</li> <li>Private DNS Zone Virtual Network Link - Links DNS zone to hub network</li> <li>Role Assignment - Grants ExternalDNS identity \"Private DNS Zone Contributor\" permissions</li> </ul> </li> <li>cluster-gateway module to support K8TRE agnostic internal gateway service<ul> <li>Gateway API CRDs - Installation of Custom Resource Definitions for Gateway API (GatewayClasses, Gateways, HTTPRoutes, ReferenceGrants, GRPCRoutes) into the cluster</li> <li>Cilium CNI (with Gateway API) installed via Helm Release resource</li> </ul> </li> <li>cluster-gitops module deploys argocd into a management AKS cluster<ul> <li>Azure AD Resources<ul> <li>Azure AD Application - ArgoCD application registration with OAuth permissions</li> <li>Service Principal - Service identity for the ArgoCD application</li> <li>Federated Identity Credential - Links Kubernetes service account to Azure AD application</li> </ul> </li> <li>ArgoCD Namespace</li> <li>ArgoCD Helm Release - configured with Azure AD OIDC integration and RBAC policies</li> </ul> </li> <li>cluster-argocd module configures ArgoCD to manage external Kubernetes clusters (dev and staging) by creating service accounts with cluster-admin permissions and registering the clusters with appropriate labels for GitOps automation<ul> <li>ArgoCD Clusters (i.e. dev, stg, prd)</li> <li>ArgoCD Service Account, Secret &amp; Role Binding (per managed Cluster)</li> </ul> </li> <li>infra-network module creates network infrastructure and an Application Gateway that serves as the external entry point for the k8tre platform across multiple environments<ul> <li>DNS Infrastructure<ul> <li>Private DNS Zone - AKS private endpoint DNS zone (privatelink.uksouth.azmk8s.io)</li> <li>Private DNS Zone Virtual Network Links (2x) - Links DNS zone to hub and IAC spoke networks</li> </ul> </li> <li>Application Gateway Infrastructure<ul> <li>Public IP - Static IP for Application Gateway with domain label</li> <li>Application Gateway - Standard_v2 tier with HTTPS listeners, backend pools, and SSL termination</li> </ul> </li> <li>Azure App Gateway<ul> <li>SSL Certificate - Embedded PFX certificate for HTTPS</li> <li>HTTP Listeners - Dev, staging, and production HTTPS listeners</li> <li>Backend Pools - Target cluster gateways for each environment</li> <li>Health Probes - HTTPS health checks for backend services</li> <li>Rewrite Rule Sets - host header and location rewriting for K8TRE services (e.g. Jupyterhub, DataShield)</li> </ul> </li> </ul> </li> </ul>"},{"location":"overview/#dependencies","title":"Dependencies","text":"<p>The project ensures proper dependency management and sequential deployment across each environment within the KARECTL ecosystem.</p> <p></p>"},{"location":"overview/#infrastructure-deployment","title":"Infrastructure Deployment","text":""},{"location":"overview/#prerequisites","title":"Prerequisites","text":"<ul> <li>Ensure a 'landing zone' is already deployed to an Azure tenant that follows the hub-spoke pattern and resource design implemented by LTH. For more information on LTH's landing zone see here </li> </ul>"},{"location":"overview/#configuration","title":"Configuration","text":"<p>Before applying this K8TRE infrastructure recipe for Azure, first ensure the root.hcl terragrunt file (in the envs/ directory) includes the following global variables:</p> <pre><code>locals {\n    region                                           = \"uksouth\"\n    cluster_name                                     = \"k8tre\"\n    azure_k8tre_mgmt_cluster_subscription_id         = \"6810437b-9cbb-40f4-89d8-a9b98f3de028\"\n    azure_k8tre_dev_cluster_subscription_id          = \"02b2c397-edb6-476f-b3a4-aa63e0621c53\"\n    azure_tenant_id                                  = \"30a82846-a29e-4b6b-af27-9b19418ee1b3\"\n    azure_k8tre_connectivity_subscription_id         = \"443fc06f-050e-4794-83d8-eaeee691d453\"\n    azure_k8tre_stg_cluster_subscription_id          = \"4e83168f-6204-4255-b1c0-9042c6fe5afd\"\n    azure_k8tre_mgmt_subscription_id                 = \"db3e5dae-c030-44df-8205-c512d0195e0e\"\n    argocd_admin_password                            = \"XXX\" # Set in Github Secrets  &amp; get via get_env()\n    entra_admin_group_id                             = \"8495e6fa-3c66-403b-abfe-227062b5d9d0\"  \n}\n\ngenerate \"backend\" {\n  path      = \"backend.tf\"\n  if_exists = \"overwrite_terragrunt\"\n  contents = &lt;&lt;EOF\n    terraform {\n        backend \"azurerm\" {\n            resource_group_name   = \"rg-kare-iac-core\"\n            storage_account_name  = \"stkareiacstate\"\n            container_name        = \"tfstate\"\n            key                   = \"${path_relative_to_include()}/k8tre.tfstate\"\n        }\n    }\nEOF\n\n}\n</code></pre> <p>The K8TRE-Azure components are deployed across multiple Azure subscriptions for environment isolation. See the subscription structure defined in the landing zone project here and set each subscription ID accordingly. Furthermore, this configuration defines a remote Terraform backend for state management stored within a storage account defined within the landing zone layer. Adjust this configuration to your preferred state management approach.</p>"},{"location":"overview/#installation","title":"Installation","text":"<ul> <li>Fork the K8TRE-Azure project to your organisation github (or clone if deploying locally)</li> <li>Login to Azure Cloud:</li> </ul> <pre><code>az login\n</code></pre> <ul> <li>Ensure your az account has the nessasary roles to access each landing zone subscription. Also note, in the current pre-alpha version K8TRE MVP, references to certain resources (e.g. VNETs) may still have hardcoded references:</li> </ul> <pre><code>az account list --output table\nName                   CloudName    SubscriptionId                        TenantId                              State    IsDefault\n---------------------  -----------  ------------------------------------  ------------------------------------  -------  -----------\nsub-kare-data          AzureCloud   ea2c7765-31d3-4c3f-aea3-b491555ac5c1  30a82846-a29e-4b6b-af27-9b19418ee1b3  Enabled  False\nsub-kare-dev           AzureCloud   02b2c397-edb6-476f-b3a4-aa63e0621c53  30a82846-a29e-4b6b-af27-9b19418ee1b3  Enabled  False\nsub-kare-staging       AzureCloud   4e83168f-6204-4255-b1c0-9042c6fe5afd  30a82846-a29e-4b6b-af27-9b19418ee1b3  Enabled  True\nsub-kare-production    AzureCloud   d466592d-46fb-432e-9b10-5fc47c2c5cc9  30a82846-a29e-4b6b-af27-9b19418ee1b3  Enabled  False\nsub-kare-k8sman        AzureCloud   6810437b-9cbb-40f4-89d8-a9b98f3de028  30a82846-a29e-4b6b-af27-9b19418ee1b3  Enabled  False\nsub-kare-connectivity  AzureCloud   443fc06f-050e-4794-83d8-eaeee691d453  30a82846-a29e-4b6b-af27-9b19418ee1b3  Enabled  False\nsub-kare-identity      AzureCloud   960d029d-b784-4cee-b834-6ec1903f968a  30a82846-a29e-4b6b-af27-9b19418ee1b3  Enabled  False\nsub-kare-management    AzureCloud   db3e5dae-c030-44df-8205-c512d0195e0e  30a82846-a29e-4b6b-af27-9b19418ee1b3  Enabled  False\nsub-kare-iac           AzureCloud   d72c48dc-0c7f-4fac-8ce7-fc451e32632b  30a82846-a29e-4b6b-af27-9b19418ee1b3  Enabled  False\n</code></pre> <ul> <li>Set the working directory to the envs/ directory in the project that contains the terragrunt configuration stacks:</li> <li>Do a dry run to check the current state of your Azure infrastructure (i.e. target landing zone) and terragrunt dependency graph across each stack in envs/:</li> </ul> <pre><code>terragrunt run --all --log-level trace --non-interactive -- plan\n</code></pre> <ul> <li>If successful, apply the execution plan:</li> </ul> <pre><code>terragrunt run --all --log-level trace --non-interactive -- apply\n</code></pre>"},{"location":"overview/#completion","title":"Completion","text":"<p>If you have configured the terragrunt to deploy multiple K8TRE-ready AKS clusters (e.g. dev, stg and prd environments), expect for the apply to complete between 20-25 minutes. Once deployed, verify that the clusters are healthy: - Get credentials for a deployed cluster e.g.:</p> <pre><code>az aks get-credentials --resource-group rg-k8tre-stg-uks-aks --name aks-k8tre-stg-cluster\n</code></pre> <ul> <li>Verify pods are healthy i.e., particularly cilium pods:</li> </ul> <pre><code>kubectl get pods -A | grep cilium\n\nkube-system         cilium-envoy-2hhnk                                    1/1     Running   0                 36d\nkube-system         cilium-envoy-jr5h2                                    1/1     Running   0                 36d\nkube-system         cilium-jwf24                                          1/1     Running   0                 18d\nkube-system         cilium-lqz66                                          1/1     Running   0                 18d\nkube-system         cilium-operator-598648997c-brvfn                      1/1     Running   0                 36d\nkube-system         cilium-operator-598648997c-d9hwx                      1/1     Running   0                 36d\n</code></pre>"},{"location":"public_gateway/","title":"Public Gateway","text":"<p>K8TRE provisions a cluster Gateway instance (cilium-gateway) based on Cilium's Gateway API controller to support inter and intra application traffic routing. Gateway is deployed with an internal loadbalancer K8s Service (cilium-gateway-internal-gateway). For Azure-based deployments, cilium-gateway-internal-gateway is annotated to provision the internal load balancer in Azure on the private VNet AKS is also bound. However, for K8TRE operators that require a public ingress additional infrastructure is required to route traffic from a public source to a cluster's internal gateway (load balancer).</p>"},{"location":"public_gateway/#azure-application-gateway-v2","title":"Azure Application Gateway (v2)","text":"<p>K8TRE-Azure includes the infa-network module to deploy an Azure Application Gateway (v2) with required HTTPS listeners, routing rules and backend pools for each deployed K8TRE environment (dev, stg, prd). At the K8TRE level, the internal Gateway is annotated with a domain name gw relative to each internal private domain zone per K8TRE cluster (e.g. gw.k8tre.internal, gw.dev.k8tre.internal, etc). This allows TRE operators to configure target backend pools in the Application Gateway to allow traffic routing to the relevant K8TRE cluster internal gateway load balancer.</p> <p></p> <p>The Azure Application Gateway resource is connected to the hub VNet via 'PublicGateway' subnet and allocated a Azure Public IP resource. The TRE operator, must establish a public DNS zone. For LTH's reference implementation karectl.dev is registered with an external DNS registrar with DNS records managed externally via LTH's chosen DNS registrar. However, organisations deploying to Azure may also wish to defer control to a public DNS zone resource in Azure that allows for the management of DNS records via Terraform or the Azure Portal. K8TRE-Azure employs a collection of rewrite rules to map public to private domain zones for particular services which require public ingress. For example, HTTPS requests from jupyter.stg.karectl.dev would be rewritten to jupyter.stg.k8tre.internal.</p>"},{"location":"public_gateway/#internal-gateway-routing","title":"Internal Gateway Routing","text":"<p>K8TRE services that require Gateway ingress define a host-based HTTPRoute that instructs the K8TRE internal Gateway where to route application traffic. The K8TRE gateway agnositic component includes default HTTPRoute configurations for services including Jupyter, Keycloak or federated analysis components (e.g. Opal/DataShield).</p>"},{"location":"terraform/modules/cluster/overview/","title":"Cluster","text":""},{"location":"terraform/modules/cluster/overview/#requirements","title":"Requirements","text":"<p>The following requirements are needed by this module:</p> <ul> <li> <p> terraform (&gt;= 1.7.0, &lt; 2.0.0)</p> </li> <li> <p> azurerm (~&gt; 4.26.0)</p> </li> </ul>"},{"location":"terraform/modules/cluster/overview/#resources","title":"Resources","text":"<p>The following resources are used by this module:</p> <ul> <li>azurerm_key_vault.kv (resource)</li> <li>azurerm_private_dns_zone_virtual_network_link.spoke_link (resource)</li> <li>azurerm_private_endpoint.blob (resource)</li> <li>azurerm_private_endpoint.file (resource)</li> <li>azurerm_private_endpoint.queue (resource)</li> <li>azurerm_private_endpoint.table (resource)</li> <li>azurerm_resource_group.cluster_rg (resource)</li> <li>azurerm_role_assignment.aks_can_write_storage (resource)</li> <li>azurerm_role_assignment.aks_file_share_contributor (resource)</li> <li>azurerm_role_assignment.aks_kv_secrets_officer (resource)</li> <li>azurerm_role_assignment.aks_storage_account_contributor (resource)</li> <li>azurerm_storage_account.sa (resource)</li> <li>azurerm_user_assigned_identity.aks_identity (resource)</li> <li>azurerm_private_dns_zone.blob (data source)</li> <li>azurerm_private_dns_zone.file (data source)</li> <li>azurerm_private_dns_zone.queue (data source)</li> <li>azurerm_private_dns_zone.table (data source)</li> <li>azurerm_subnet.cluster_spoke_aks_node_subnet (data source)</li> <li>azurerm_subnet.cluster_spoke_private_endpoints_subnet (data source)</li> <li>azurerm_virtual_network.cluster_spoke_vnet (data source)</li> </ul>"},{"location":"terraform/modules/cluster/overview/#required-inputs","title":"Required Inputs","text":"<p>The following input variables are required:</p>"},{"location":"terraform/modules/cluster/overview/#entra_admin_group_id","title":"entra_admin_group_id","text":"<p>Description: Entra k8s admin group id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster/overview/#environment","title":"environment","text":"<p>Description: The name of target cluster environment</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster/overview/#k8tre_cluster_subscription_id","title":"k8tre_cluster_subscription_id","text":"<p>Description: target cluster sub id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster/overview/#k8tre_connectivity_subscription_id","title":"k8tre_connectivity_subscription_id","text":"<p>Description: infra networking sub id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster/overview/#lz_network_dns_resource_group_name","title":"lz_network_dns_resource_group_name","text":"<p>Description: Resource group name for the landing zone network DNS resources</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster/overview/#private_dns_zone_id","title":"private_dns_zone_id","text":"<p>Description: private dns id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster/overview/#private_dns_zone_name","title":"private_dns_zone_name","text":"<p>Description: private dns name</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster/overview/#region","title":"region","text":"<p>Description: infrastructure region</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster/overview/#tenant_id","title":"tenant_id","text":"<p>Description: Azure tenant id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster/overview/#optional-inputs","title":"Optional Inputs","text":"<p>The following input variables are optional (have default values):</p>"},{"location":"terraform/modules/cluster/overview/#service_name","title":"service_name","text":"<p>Description: Name of the service</p> <p>Type: <code>string</code></p> <p>Default: <code>\"k8tre\"</code></p>"},{"location":"terraform/modules/cluster/overview/#outputs","title":"Outputs","text":"<p>The following outputs are exported:</p>"},{"location":"terraform/modules/cluster/overview/#client_certificate","title":"client_certificate","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/cluster/overview/#client_key","title":"client_key","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/cluster/overview/#cluster_ca_certificate","title":"cluster_ca_certificate","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/cluster/overview/#environment_1","title":"environment","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/cluster/overview/#fq_cluster_name","title":"fq_cluster_name","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/cluster/overview/#kube_config","title":"kube_config","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/cluster/overview/#kube_host","title":"kube_host","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/cluster/overview/#oidc_issuer_url","title":"oidc_issuer_url","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/cluster/overview/#resource_group_name","title":"resource_group_name","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/cluster/overview/#modules","title":"Modules","text":"<p>The following Modules are called:</p>"},{"location":"terraform/modules/cluster/overview/#aks_cluster","title":"aks_cluster","text":"<p>Source: ./avm-patterns/avm-ptn-aks-production</p> <p>Version:</p>"},{"location":"terraform/modules/cluster-argocd/overview/","title":"Managed Argo Clusters","text":""},{"location":"terraform/modules/cluster-argocd/overview/#requirements","title":"Requirements","text":"<p>The following requirements are needed by this module:</p> <ul> <li> <p> terraform (&gt;= 1.3.0)</p> </li> <li> <p> argocd (1.0.3)</p> </li> <li> <p> azurerm (~&gt; 4.26.0)</p> </li> <li> <p> kubernetes (~&gt; 2.23)</p> </li> </ul>"},{"location":"terraform/modules/cluster-argocd/overview/#resources","title":"Resources","text":"<p>The following resources are used by this module:</p> <ul> <li>argocd_cluster.external (resource)</li> <li>argocd_cluster.stg_external (resource)</li> <li>kubernetes_cluster_role_binding.argocd (resource)</li> <li>kubernetes_cluster_role_binding.stg_argocd (resource)</li> <li>kubernetes_secret_v1.argocd_gen_sa_token (resource)</li> <li>kubernetes_secret_v1.stg_argocd_gen_sa_token (resource)</li> <li>kubernetes_service_account_v1.argocd (resource)</li> <li>kubernetes_service_account_v1.stg_argocd (resource)</li> <li>kubernetes_secret_v1.argocd_sa_token (data source)</li> <li>kubernetes_secret_v1.stg_argocd_sa_token (data source)</li> </ul>"},{"location":"terraform/modules/cluster-argocd/overview/#required-inputs","title":"Required Inputs","text":"<p>The following input variables are required:</p>"},{"location":"terraform/modules/cluster-argocd/overview/#spn_client_secret","title":"SPN_CLIENT_SECRET","text":"<p>Description: SPN account secret</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#argocd_admin_password","title":"argocd_admin_password","text":"<p>Description: The ArgoCD admin password</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#azure_k8tre_dev_cluster_subscription_id","title":"azure_k8tre_dev_cluster_subscription_id","text":"<p>Description: target cluster sub id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#azure_k8tre_mgmt_cluster_subscription_id","title":"azure_k8tre_mgmt_cluster_subscription_id","text":"<p>Description: infra networking sub id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#azure_k8tre_stg_cluster_subscription_id","title":"azure_k8tre_stg_cluster_subscription_id","text":"<p>Description: infra networking sub id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#azure_tenant_id","title":"azure_tenant_id","text":"<p>Description: Azure tenant ID</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#dev_cluster_ca_certificate","title":"dev_cluster_ca_certificate","text":"<p>Description: The base64-encoded cluster CA certificate</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#dev_kube_host","title":"dev_kube_host","text":"<p>Description: The AKS API server host (FQDN)</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#mgmt_cluster_ca_certificate","title":"mgmt_cluster_ca_certificate","text":"<p>Description: The base64-encoded cluster CA certificate</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#mgmt_kube_host","title":"mgmt_kube_host","text":"<p>Description: The AKS API server host (FQDN)</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#spn_client_id","title":"spn_client_id","text":"<p>Description: Service Principal Client ID</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#stg_cluster_ca_certificate","title":"stg_cluster_ca_certificate","text":"<p>Description: The base64-encoded cluster CA certificate</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#stg_kube_host","title":"stg_kube_host","text":"<p>Description: The AKS API server host (FQDN)</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-argocd/overview/#optional-inputs","title":"Optional Inputs","text":"<p>No optional inputs.</p>"},{"location":"terraform/modules/cluster-argocd/overview/#outputs","title":"Outputs","text":"<p>No outputs.</p>"},{"location":"terraform/modules/cluster-argocd/overview/#modules","title":"Modules","text":"<p>No modules.</p>"},{"location":"terraform/modules/cluster-dns/overview/","title":"Cluster DNS","text":""},{"location":"terraform/modules/cluster-dns/overview/#requirements","title":"Requirements","text":"<p>The following requirements are needed by this module:</p> <ul> <li> <p> terraform (&gt;= 1.11.0)</p> </li> <li> <p> azurerm (~&gt; 4.26.0)</p> </li> <li> <p> helm (~&gt; 2.13)</p> </li> <li> <p> kubernetes (~&gt; 2.23)</p> </li> </ul>"},{"location":"terraform/modules/cluster-dns/overview/#resources","title":"Resources","text":"<p>The following resources are used by this module:</p> <ul> <li>azurerm_federated_identity_credential.externaldns (resource)</li> <li>azurerm_private_dns_zone.dns (resource)</li> <li>azurerm_private_dns_zone_virtual_network_link.externaldns_link (resource)</li> <li>azurerm_role_assignment.externaldns_dns (resource)</li> <li>azurerm_user_assigned_identity.externaldns (resource)</li> <li>azurerm_virtual_network.hub_vnet (data source)</li> </ul>"},{"location":"terraform/modules/cluster-dns/overview/#required-inputs","title":"Required Inputs","text":"<p>The following input variables are required:</p>"},{"location":"terraform/modules/cluster-dns/overview/#spn_client_secret","title":"SPN_CLIENT_SECRET","text":"<p>Description: SPN account secret</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#azure_k8tre_connectivity_subscription_id","title":"azure_k8tre_connectivity_subscription_id","text":"<p>Description: target cluster subscription id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#azure_tenant_id","title":"azure_tenant_id","text":"<p>Description: Azure tenant ID</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#cluster_ca_certificate","title":"cluster_ca_certificate","text":"<p>Description: The base64-encoded cluster CA certificate</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#cluster_domain_name","title":"cluster_domain_name","text":"<p>Description: The domain name for the cluster DNS</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#cluster_name","title":"cluster_name","text":"<p>Description: The name of the AKS cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#cluster_resource_group_name","title":"cluster_resource_group_name","text":"<p>Description: The resource group name of the AKS cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#cluster_subscription_id","title":"cluster_subscription_id","text":"<p>Description: target cluster subscription id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#fq_cluster_name","title":"fq_cluster_name","text":"<p>Description: The fully qualified cluster name (FQDN) of the AKS cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#kube_host","title":"kube_host","text":"<p>Description: The AKS API server host (FQDN)</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#lz_hub_vnet_name","title":"lz_hub_vnet_name","text":"<p>Description: Name of the landing zone hub VNet</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#lz_network_dns_resource_group_name","title":"lz_network_dns_resource_group_name","text":"<p>Description: Name of the resource group for the landing zone hub DNS resources</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#lz_network_resource_group_name","title":"lz_network_resource_group_name","text":"<p>Description: Name of the resource group for the landing zone hub networking resources</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#oidc_issuer_url","title":"oidc_issuer_url","text":"<p>Description: oidc_issuer_url of k8s cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#spn_client_id","title":"spn_client_id","text":"<p>Description: Service Principal Client ID</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-dns/overview/#optional-inputs","title":"Optional Inputs","text":"<p>No optional inputs.</p>"},{"location":"terraform/modules/cluster-dns/overview/#outputs","title":"Outputs","text":"<p>No outputs.</p>"},{"location":"terraform/modules/cluster-dns/overview/#modules","title":"Modules","text":"<p>No modules.</p>"},{"location":"terraform/modules/cluster-gateway/overview/","title":"Internal Gateway","text":""},{"location":"terraform/modules/cluster-gateway/overview/#requirements","title":"Requirements","text":"<p>The following requirements are needed by this module:</p> <ul> <li> <p> terraform (&gt;= 1.11.0)</p> </li> <li> <p> azurerm (~&gt; 4.34.0)</p> </li> <li> <p> helm (~&gt; 2.13)</p> </li> <li> <p> http (~&gt; 3.0)</p> </li> <li> <p> kubectl (~&gt; 1.19.0)</p> </li> <li> <p> kubernetes (~&gt; 2.37.1)</p> </li> </ul>"},{"location":"terraform/modules/cluster-gateway/overview/#resources","title":"Resources","text":"<p>The following resources are used by this module:</p> <ul> <li>helm_release.cilium (resource)</li> <li>kubectl_manifest.gateway__crds (resource)</li> <li>http_http.gateway_crds (data source)</li> </ul>"},{"location":"terraform/modules/cluster-gateway/overview/#required-inputs","title":"Required Inputs","text":"<p>The following input variables are required:</p>"},{"location":"terraform/modules/cluster-gateway/overview/#spn_client_secret","title":"SPN_CLIENT_SECRET","text":"<p>Description: SPN account secret</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gateway/overview/#azure_tenant_id","title":"azure_tenant_id","text":"<p>Description: Azure tenant ID</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gateway/overview/#cluster_ca_certificate","title":"cluster_ca_certificate","text":"<p>Description: The base64-encoded cluster CA certificate</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gateway/overview/#cluster_name","title":"cluster_name","text":"<p>Description: The name of the AKS cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gateway/overview/#kube_host","title":"kube_host","text":"<p>Description: The AKS API server host (FQDN)</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gateway/overview/#spn_client_id","title":"spn_client_id","text":"<p>Description: Service Principal Client ID</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gateway/overview/#optional-inputs","title":"Optional Inputs","text":"<p>No optional inputs.</p>"},{"location":"terraform/modules/cluster-gateway/overview/#outputs","title":"Outputs","text":"<p>No outputs.</p>"},{"location":"terraform/modules/cluster-gateway/overview/#modules","title":"Modules","text":"<p>No modules.</p>"},{"location":"terraform/modules/cluster-gitops/overview/","title":"GitOps (ArgoCD)","text":""},{"location":"terraform/modules/cluster-gitops/overview/#requirements","title":"Requirements","text":"<p>The following requirements are needed by this module:</p> <ul> <li> <p> terraform (&gt;= 1.3.0)</p> </li> <li> <p> azuread (~&gt; 2.47.0)</p> </li> <li> <p> helm (~&gt; 2.13)</p> </li> <li> <p> kubernetes (~&gt; 2.23)</p> </li> </ul>"},{"location":"terraform/modules/cluster-gitops/overview/#resources","title":"Resources","text":"<p>The following resources are used by this module:</p> <ul> <li>azuread_application.argocd (resource)</li> <li>azuread_application_federated_identity_credential.argocd_federation (resource)</li> <li>azuread_service_principal.argocd (resource)</li> <li>helm_release.argocd (resource)</li> <li>kubernetes_namespace.argocd (resource)</li> <li>azuread_application_published_app_ids.well_known (data source)</li> <li>azuread_service_principal.ms_graph (data source)</li> </ul>"},{"location":"terraform/modules/cluster-gitops/overview/#required-inputs","title":"Required Inputs","text":"<p>The following input variables are required:</p>"},{"location":"terraform/modules/cluster-gitops/overview/#spn_client_secret","title":"SPN_CLIENT_SECRET","text":"<p>Description: SPN account secret</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#argocd_admin_password","title":"argocd_admin_password","text":"<p>Description: The name of the AKS cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#client_certificate","title":"client_certificate","text":"<p>Description: The resource group name of the AKS cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#client_key","title":"client_key","text":"<p>Description: The name of the AKS cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#cluster_ca_certificate","title":"cluster_ca_certificate","text":"<p>Description: The base64-encoded cluster CA certificate</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#cluster_tenant_id","title":"cluster_tenant_id","text":"<p>Description: Identifier of the Entra tenant where the cluster is deployed</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#entra_admin_group_id","title":"entra_admin_group_id","text":"<p>Description: Identifier of the Entra admin group that will be granted admin access to ArgoCD</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#fq_cluster_name","title":"fq_cluster_name","text":"<p>Description: The name of the AKS cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#k8tre_cluster_subscription_id","title":"k8tre_cluster_subscription_id","text":"<p>Description: sub id</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#kube_host","title":"kube_host","text":"<p>Description: The AKS API server host (FQDN)</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#resource_group_name","title":"resource_group_name","text":"<p>Description: The resource group name of the AKS cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#spn_client_id","title":"spn_client_id","text":"<p>Description: Identifier of the Service Principal that will be used to authenticate to the cluster</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/cluster-gitops/overview/#optional-inputs","title":"Optional Inputs","text":"<p>No optional inputs.</p>"},{"location":"terraform/modules/cluster-gitops/overview/#outputs","title":"Outputs","text":"<p>No outputs.</p>"},{"location":"terraform/modules/cluster-gitops/overview/#modules","title":"Modules","text":"<p>No modules.</p>"},{"location":"terraform/modules/infra-network/overview/","title":"Networking","text":""},{"location":"terraform/modules/infra-network/overview/#requirements","title":"Requirements","text":"<p>The following requirements are needed by this module:</p> <ul> <li> <p> terraform (&gt;= 1.7.0, &lt; 2.0.0)</p> </li> <li> <p> azurerm (~&gt; 4.26.0)</p> </li> </ul>"},{"location":"terraform/modules/infra-network/overview/#resources","title":"Resources","text":"<p>The following resources are used by this module:</p> <ul> <li>azurerm_application_gateway.appgw (resource)</li> <li>azurerm_private_dns_zone.pe_private_dns (resource)</li> <li>azurerm_private_dns_zone_virtual_network_link.hub_link (resource)</li> <li>azurerm_private_dns_zone_virtual_network_link.iac_link (resource)</li> <li>azurerm_public_ip.appgw_pip (resource)</li> <li>azurerm_resource_group.rg (data source)</li> <li>azurerm_subnet.subnet (data source)</li> <li>azurerm_virtual_network.hub_vnet (data source)</li> <li>azurerm_virtual_network.iac_vnet (data source)</li> </ul>"},{"location":"terraform/modules/infra-network/overview/#required-inputs","title":"Required Inputs","text":"<p>The following input variables are required:</p>"},{"location":"terraform/modules/infra-network/overview/#app_gateway_ssl_certificate_filename","title":"app_gateway_ssl_certificate_filename","text":"<p>Description: App gateway SSL PFX certificate filename in certs directory</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#app_gateway_ssl_certificate_passphrase","title":"app_gateway_ssl_certificate_passphrase","text":"<p>Description: Passphrase for the app gateway SSL PFX certificate</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#azure_k8tre_connectivity_subscription_id","title":"azure_k8tre_connectivity_subscription_id","text":"<p>Description: Subscription ID for Azure landing zone hub networking resources</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#azure_k8tre_iac_subscription_id","title":"azure_k8tre_iac_subscription_id","text":"<p>Description: Subscription ID for Landing Zone IaC resources</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#internal_dns_zone_name","title":"internal_dns_zone_name","text":"<p>Description: The internal DNS zone for K8TRE e.g. k8tre.internal</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#lz_hub_vnet_name","title":"lz_hub_vnet_name","text":"<p>Description: Name of the landing zone hub VNet</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#lz_iac_core_resource_group_name","title":"lz_iac_core_resource_group_name","text":"<p>Description: Name of the resource group for IaC core resources</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#lz_iac_spoke_vnet_name","title":"lz_iac_spoke_vnet_name","text":"<p>Description: Name of the landing zone spoke VNet for IaC resources</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#lz_network_dns_resource_group_name","title":"lz_network_dns_resource_group_name","text":"<p>Description: Name of the resource group for the landing zone hub DNS resources</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#lz_network_resource_group_name","title":"lz_network_resource_group_name","text":"<p>Description: Name of the resource group for the landing zone hub networking resources</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#public_dns_zone_name","title":"public_dns_zone_name","text":"<p>Description: The public DNS zone name for an organisations version of K8TRE, e.g. karectl.org</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#region","title":"region","text":"<p>Description: infrastructure region</p> <p>Type: <code>string</code></p>"},{"location":"terraform/modules/infra-network/overview/#optional-inputs","title":"Optional Inputs","text":"<p>The following input variables are optional (have default values):</p>"},{"location":"terraform/modules/infra-network/overview/#cluster_name","title":"cluster_name","text":"<p>Description: Name of the cluster</p> <p>Type: <code>string</code></p> <p>Default: <code>\"k8tre\"</code></p>"},{"location":"terraform/modules/infra-network/overview/#common_tags","title":"common_tags","text":"<p>Description: Resource tags for Azure policy rules</p> <p>Type: <code>map(string)</code></p> <p>Default: <code>{}</code></p>"},{"location":"terraform/modules/infra-network/overview/#environments","title":"environments","text":"<p>Description: names for the environments to be created, e.g. dev, stg, prd</p> <p>Type: <code>list(string)</code></p> <p>Default: <code>[]</code></p>"},{"location":"terraform/modules/infra-network/overview/#k8tre_service_domains","title":"k8tre_service_domains","text":"<p>Description: service domains for k8tre services that require public ingress, e.g. jupyter, opal, keycloak</p> <p>Type: <code>list(string)</code></p> <p>Default: <code>[]</code></p>"},{"location":"terraform/modules/infra-network/overview/#outputs","title":"Outputs","text":"<p>The following outputs are exported:</p>"},{"location":"terraform/modules/infra-network/overview/#private_dns_zone_id","title":"private_dns_zone_id","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/infra-network/overview/#private_dns_zone_name","title":"private_dns_zone_name","text":"<p>Description: n/a</p>"},{"location":"terraform/modules/infra-network/overview/#modules","title":"Modules","text":"<p>No modules.</p>"}]}